# Path: /root/begasist/docker-compose.dev.yml
services:
  suite:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: begasist-suite:dev
    container_name: begasist-suite
    command: pnpm dev -p 3000 -H 0.0.0.0
    environment:
      - NODE_ENV=development
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
      - CHOKIDAR_INTERVAL=300
      - TAILWIND_MODE=watch
      # === MCP (dev) ===
      - USE_MCP_RESERVATIONS=true
      - MCP_API_KEY=dev_key
      - MCP_ENDPOINT=http://suite:3000/api/mcp
      # === Astra ===
      - ASTRA_DB_APPLICATION_TOKEN=${ASTRA_DB_APPLICATION_TOKEN}
      - ASTRA_DB_KEYSPACE=${ASTRA_DB_KEYSPACE:-hotel_data}
      - ASTRA_DB_URL=${ASTRA_DB_URL}
    ports:
      - "3000:3000"
    volumes:
      - .:/app:cached          # âœ… Ãºnico volumen necesario en dev
    depends_on:
      - redis
    init: true                 # (opcional, recomendado)
    stop_signal: SIGINT        # (opcional)
    stop_grace_period: 20s     # (opcional)
    restart: unless-stopped

  redis:
    image: redis:7.2-alpine
    container_name: begasist-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped

volumes:
  redis_data:

# ðŸ”— Red compartida con nombre estable (usable por otros compose)
networks:
  default:
    name: begasist_net
